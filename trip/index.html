<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Trip pool&gym hours</title>
</head>
<body>
<div class="container" style="max-width: 400px">
    <div style="text-align: center">I am a
        <span class="dropdown">
      <button class="btn btn-primary dropdown-toggle genderClass" type="button" data-bs-toggle="dropdown" aria-expanded="false">
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
        <li><a class="dropdown-item" href="#" id="boyLi">Boy</a></li>
        <li><a class="dropdown-item" href="#" id="girlLi">Girl</a></li>
      </ul>
    </span>
    </div>
    <div id="nowAvailable" style="text-align: center"></div>
    <div id="today">
        <h2 style="text-align: center"><span class="genderClass"></span>s' hours for today</h2>
        <table class="table">
            <thead>
            <tr>
                <th scope="col">From</th>
                <th scope="col">To</th>
                <th scope="col">Type</th>
            </tr>
            </thead>
            <tbody id="todayScheduleTableBody">
            </tbody>
        </table>
    </div>
    <div id="tomorrow">
        <h2 style="text-align: center"><span class="genderClass"></span>s' hours for tomorrow</h2>
        <table class="table">
            <thead>
            <tr>
                <th scope="col">From</th>
                <th scope="col">To</th>
                <th scope="col">Type</th>
            </tr>
            </thead>
            <tbody id="tomorrowScheduleTableBody">
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
<script>
    const schedule = new Map([
        ["Boy", [
            {type: "Pool", dayParity: 0, fromHour: 7, toHour: 10},
            {type: "Pool", dayParity: 0, fromHour: 12, toHour: 15},
            {type: "Pool", dayParity: 1, fromHour: 10, toHour: 12},
            {type: "Pool", dayParity: 1, fromHour: 15, toHour: 18},
            {type: "Gym", dayParity: 0, fromHour: 3, toHour: 6},
            {type: "Gym", dayParity: 0, fromHour: 9, toHour: 12},
            {type: "Gym", dayParity: 0, fromHour: 15, toHour: 18},
            {type: "Gym", dayParity: 0, fromHour: 21, toHour: 24},
            {type: "Gym", dayParity: 1, fromHour: 6, toHour: 9},
            {type: "Gym", dayParity: 1, fromHour: 12, toHour: 15},
            {type: "Gym", dayParity: 1, fromHour: 18, toHour: 21},
        ]],
        ["Girl", [
            {type: "Gym", dayParity: 0, fromHour: 6, toHour: 9},
            {type: "Gym", dayParity: 0, fromHour: 12, toHour: 15},
            {type: "Gym", dayParity: 0, fromHour: 18, toHour: 21},
            {type: "Gym", dayParity: 1, fromHour: 3, toHour: 6},
            {type: "Gym", dayParity: 1, fromHour: 9, toHour: 12},
            {type: "Gym", dayParity: 1, fromHour: 15, toHour: 18},
            {type: "Gym", dayParity: 1, fromHour: 21, toHour: 24},
            {type: "Pool", dayParity: 0, fromHour: 10, toHour: 12},
            {type: "Pool", dayParity: 0, fromHour: 15, toHour: 18},
            {type: "Pool", dayParity: 1, fromHour: 7, toHour: 10},
            {type: "Pool", dayParity: 1, fromHour: 12, toHour: 15},
        ]]
    ]);

    $(document).ready(function(){
        const gender = localStorage.getItem("gender");
        if (gender === null) {
            setSchedule("Girl");
        } else {
            setSchedule(gender);
        }
        $(".dropdown-menu li a").click(function() {
            setSchedule($(this).text());
        })
    });


    Date.prototype.addHours = function(h) {
        this.setTime(this.getTime() + (h*60*60*1000));
        return this;
    }

    function setSchedule(gender) {
        localStorage.setItem("gender", gender);
        $("#genderButton").text(gender);
        $(".genderClass").text(gender);
        const todayParity = new Date().getDate() % 2;
        const tomorrowParity = new Date().addHours(24).getDate() % 2;
        const hour = new Date().getHours();
        const genderSchedule = schedule.get(gender);
        const todayRows = [];
        const tomorrowRows = [];
        genderSchedule.forEach(obj => {
            if (obj.dayParity === todayParity && obj.fromHour <= hour && hour < obj.toHour) {
                $("#nowAvailable").html("Now available: <span style='font-size: xx-large; font-weight: bolder'>" + obj.type + "</span>");
            }
            if (obj.dayParity === todayParity && hour < obj.toHour) {
                todayRows.push(obj);
            }
            if (obj.dayParity === tomorrowParity) {
                tomorrowRows.push(obj);
            }
        });
        if (todayRows.length === 0) {
            $("#today").hide();
        }
        renderRows(todayRows, "#todayScheduleTableBody")
        renderRows(tomorrowRows, "#tomorrowScheduleTableBody")
    }

    function renderRows(rows, tableBodyId) {
        $(tableBodyId).html("");
        rows.sort((a, b) => a.fromHour - b.fromHour);
        rows.forEach(obj => {
            var newRowContent = "<tr><td>"+obj.fromHour+":00</td><td>"+obj.toHour+":00</td><td>"+obj.type+"</td></tr>";
            $(tableBodyId).append(newRowContent);
        });
    }
</script>
</body>
</html>
